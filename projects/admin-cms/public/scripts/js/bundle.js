(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getFieldValue = (id) => document.getElementById(id).value;

},{}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });

},{}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const request_1 = require("./request");
const helpers_1 = require("./helpers");
const screenshotsParentNode = document.querySelector("#screenshots__list");
const iconParentNode = document.querySelector(".icon");
let iconURL = "";
let screenshotURLs = [];
document
    .querySelector("#screenshots")
    .addEventListener("change", async (e) => {
    const { target: { files } } = e;
    const formData = new FormData();
    for (let i = 0; i < files.length; i++) {
        formData.append("files", files[i]);
    }
    try {
        const response = await request_1.UPLOAD(formData);
        const { urls } = await response;
        screenshotURLs = urls;
        drawScreenshotList(screenshotsParentNode, screenshotURLs);
    }
    catch (error) {
        console.error(error);
    }
});
document
    .querySelector("#icon")
    .addEventListener("change", async (e) => {
    const { target: { files } } = e;
    const formData = new FormData();
    formData.append("files", files[0]);
    try {
        const data = await request_1.UPLOAD(formData);
        const { urls: [url] } = data;
        iconURL = url;
        drawIcon(iconParentNode, url);
    }
    catch (error) {
        console.error(error);
    }
});
document.querySelector(".new-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const data = new FormData();
    data.append("title", helpers_1.getFieldValue("title"));
    data.append("description", helpers_1.getFieldValue("description"));
    data.append("google-link", helpers_1.getFieldValue("google-link"));
    data.append("icon", iconURL);
    for (let i = 0; i < screenshotURLs.length; i++) {
        data.append("screenshots", screenshotURLs[i]);
    }
    try {
        const response = await request_1.POST("/projects", data);
        console.log(response);
    }
    catch (error) {
        console.log(error);
    }
});
const drag = (e, url) => e.dataTransfer.setData("text", JSON.stringify(url));
const drop = (e, currentURL) => {
    e.preventDefault();
    const newURL = JSON.parse(e.dataTransfer.getData("text"));
    const newScreenshotURLS = screenshotURLs.map((url, index) => {
        if (index === newURL.index) {
            return currentURL.url;
        }
        if (index === currentURL.index) {
            return newURL.url;
        }
        return url;
    });
    screenshotURLs = [...newScreenshotURLS];
    drawScreenshotList(screenshotsParentNode, newScreenshotURLS);
};
const drawScreenshotList = (screenshotsNode, urls) => {
    while (screenshotsNode.firstChild) {
        screenshotsNode.removeChild(screenshotsNode.firstChild);
    }
    urls.forEach((url, index) => {
        const node = document.createElement("div");
        const imgNode = document.createElement("img");
        node.classList.add("col-6", "col-md-3", "screenshots__list__item", `screenshots__list__item__${index}`);
        node.draggable = true;
        imgNode.src = url;
        imgNode.alt = "screenshot";
        node.appendChild(imgNode);
        screenshotsNode.appendChild(node);
        document
            .querySelector(`.screenshots__list__item__${index}`)
            .addEventListener("dragstart", (e) => drag(e, { index, url }));
        document
            .querySelector(`.screenshots__list__item__${index}`)
            .addEventListener("drop", (e) => drop(e, { index, url }));
        document
            .querySelector(`.screenshots__list__item__${index}`)
            .addEventListener("dragover", (e) => e.preventDefault());
    });
};
const drawIcon = (iconNode, url) => {
    while (iconNode.firstChild) {
        iconNode.removeChild(iconNode.firstChild);
    }
    const imgNode = document.createElement("img");
    imgNode.classList.add("icon__item");
    imgNode.src = url;
    imgNode.alt = "screenshot";
    iconNode.appendChild(imgNode);
};

},{"./helpers":1,"./request":4}],4:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UPLOAD = (data, url = "/images/upload") => fetch(url, {
    method: "POST",
    body: data
}).then(res => res.json());
exports.POST = (url, data) => fetch(url, {
    method: "POST",
    body: data,
    headers: {
        "Content-Type": "application/x-www-form-urlencoded"
    }
}).then(res => res.json());
exports.GET = (url) => fetch(url).then(res => res.json());
exports.PUT = (url, data) => fetch(url, {
    method: "PUT",
    body: data
}).then(res => res.json());
exports.DELETE = (url) => fetch(url, { method: "DELETE" }).then(res => res.json());

},{}]},{},[1,2,3,4])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJwdWJsaWMvc2NyaXB0cy90cy9oZWxwZXJzLnRzIiwicHVibGljL3NjcmlwdHMvdHMvbmV3LXByb2plY3QudHMiLCJwdWJsaWMvc2NyaXB0cy90cy9yZXF1ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNFYSxRQUFBLGFBQWEsR0FBRyxDQUFDLEVBQVUsRUFBRSxFQUFFLENBQ3hDLFFBQVEsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFnQyxDQUFDLEtBQUssQ0FBQzs7Ozs7Ozs7O0FDSHJFLHVDQUF5QztBQUV6Qyx1Q0FBMEM7QUFFMUMsTUFBTSxxQkFBcUIsR0FBWSxRQUFRLENBQUMsYUFBYSxDQUMzRCxvQkFBb0IsQ0FDckIsQ0FBQztBQUNGLE1BQU0sY0FBYyxHQUFZLFFBQVEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDaEUsSUFBSSxPQUFPLEdBQVcsRUFBRSxDQUFDO0FBQ3pCLElBQUksY0FBYyxHQUFhLEVBQUUsQ0FBQztBQUVsQyxRQUFRO0tBQ0wsYUFBYSxDQUFDLGNBQWMsQ0FBQztLQUM3QixnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsS0FBSyxFQUFFLENBQWlCLEVBQUUsRUFBRTtJQUN0RCxNQUFNLEVBQ0osTUFBTSxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQ2xCLEdBQUcsQ0FBQyxDQUFDO0lBQ04sTUFBTSxRQUFRLEdBQUcsSUFBSSxRQUFRLEVBQUUsQ0FBQztJQUdoQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtRQUNyQyxRQUFRLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUNwQztJQUVELElBQUk7UUFDRixNQUFNLFFBQVEsR0FBRyxNQUFNLGdCQUFNLENBQUMsUUFBUSxD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RUFBRSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiaW1wb3J0IHsgSFRNTElucHV0RXZlbnQgfSBmcm9tIFwiLi9pbnRlcmZhY2VzXCI7XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0RmllbGRWYWx1ZSA9IChpZDogc3RyaW5nKSA9PlxyXG4gICgoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpIGFzIHVua25vd24pIGFzIEhUTUxJbnB1dEV2ZW50KS52YWx1ZTtcclxuIiwiaW1wb3J0IHsgUE9TVCwgVVBMT0FEIH0gZnJvbSBcIi4vcmVxdWVzdFwiO1xyXG5pbXBvcnQgeyBIVE1MSW5wdXRFdmVudCwgSVNjcmVlbnNob3QgfSBmcm9tIFwiLi9pbnRlcmZhY2VzXCI7XHJcbmltcG9ydCB7IGdldEZpZWxkVmFsdWUgfSBmcm9tIFwiLi9oZWxwZXJzXCI7XHJcblxyXG5jb25zdCBzY3JlZW5zaG90c1BhcmVudE5vZGU6IEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiI3NjcmVlbnNob3RzX19saXN0XCJcclxuKTtcclxuY29uc3QgaWNvblBhcmVudE5vZGU6IEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmljb25cIik7XHJcbmxldCBpY29uVVJMOiBzdHJpbmcgPSBcIlwiO1xyXG5sZXQgc2NyZWVuc2hvdFVSTHM6IHN0cmluZ1tdID0gW107XHJcblxyXG5kb2N1bWVudFxyXG4gIC5xdWVyeVNlbGVjdG9yKFwiI3NjcmVlbnNob3RzXCIpXHJcbiAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgYXN5bmMgKGU6IEhUTUxJbnB1dEV2ZW50KSA9PiB7XHJcbiAgICBjb25zdCB7XHJcbiAgICAgIHRhcmdldDogeyBmaWxlcyB9XHJcbiAgICB9ID0gZTtcclxuICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcblxyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBwcmVmZXItZm9yLW9mXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGZvcm1EYXRhLmFwcGVuZChcImZpbGVzXCIsIGZpbGVzW2ldKTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IFVQTE9BRChmb3JtRGF0YSk7XHJcbiAgICAgIGNvbnN0IHsgdXJscyB9ID0gYXdhaXQgcmVzcG9uc2U7XHJcbiAgICAgIHNjcmVlbnNob3RVUkxzID0gdXJscztcclxuXHJcbiAgICAgIGRyYXdTY3JlZW5zaG90TGlzdChzY3JlZW5zaG90c1BhcmVudE5vZGUsIHNjcmVlbnNob3RVUkxzKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuZG9jdW1lbnRcclxuICAucXVlcnlTZWxlY3RvcihcIiNpY29uXCIpXHJcbiAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgYXN5bmMgKGU6IEhUTUxJbnB1dEV2ZW50KSA9PiB7XHJcbiAgICBjb25zdCB7XHJcbiAgICAgIHRhcmdldDogeyBmaWxlcyB9XHJcbiAgICB9ID0gZTtcclxuICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICBmb3JtRGF0YS5hcHBlbmQoXCJmaWxlc1wiLCBmaWxlc1swXSk7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IFVQTE9BRChmb3JtRGF0YSk7XHJcbiAgICAgIGNvbnN0IHtcclxuICAgICAgICB1cmxzOiBbdXJsXVxyXG4gICAgICB9ID0gZGF0YTtcclxuXHJcbiAgICAgIGljb25VUkwgPSB1cmw7XHJcbiAgICAgIGRyYXdJY29uKGljb25QYXJlbnROb2RlLCB1cmwpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm5ldy1mb3JtXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgYXN5bmMgZSA9PiB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICBjb25zdCBkYXRhOiBGb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gIGRhdGEuYXBwZW5kKFwidGl0bGVcIiwgZ2V0RmllbGRWYWx1ZShcInRpdGxlXCIpKTtcclxuICBkYXRhLmFwcGVuZChcImRlc2NyaXB0aW9uXCIsIGdldEZpZWxkVmFsdWUoXCJkZXNjcmlwdGlvblwiKSk7XHJcbiAgZGF0YS5hcHBlbmQoXCJnb29nbGUtbGlua1wiLCBnZXRGaWVsZFZhbHVlKFwiZ29vZ2xlLWxpbmtcIikpO1xyXG4gIGRhdGEuYXBwZW5kKFwiaWNvblwiLCBpY29uVVJMKTtcclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IHByZWZlci1mb3Itb2ZcclxuICBmb3IgKGxldCBpID0gMDsgaSA8IHNjcmVlbnNob3RVUkxzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICBkYXRhLmFwcGVuZChcInNjcmVlbnNob3RzXCIsIHNjcmVlbnNob3RVUkxzW2ldKTtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IFBPU1QoXCIvcHJvamVjdHNcIiwgZGF0YSk7XHJcbiAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICB9XHJcbn0pO1xyXG5cclxuY29uc3QgZHJhZyA9IChlOiBIVE1MSW5wdXRFdmVudCwgdXJsOiBJU2NyZWVuc2hvdCkgPT5cclxuICBlLmRhdGFUcmFuc2Zlci5zZXREYXRhKFwidGV4dFwiLCBKU09OLnN0cmluZ2lmeSh1cmwpKTtcclxuXHJcbmNvbnN0IGRyb3AgPSAoZTogSFRNTElucHV0RXZlbnQsIGN1cnJlbnRVUkw6IElTY3JlZW5zaG90KSA9PiB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0IG5ld1VSTCA9IEpTT04ucGFyc2UoZS5kYXRhVHJhbnNmZXIuZ2V0RGF0YShcInRleHRcIikpO1xyXG4gIGNvbnN0IG5ld1NjcmVlbnNob3RVUkxTID0gc2NyZWVuc2hvdFVSTHMubWFwKCh1cmwsIGluZGV4KSA9PiB7XHJcbiAgICBpZiAoaW5kZXggPT09IG5ld1VSTC5pbmRleCkge1xyXG4gICAgICByZXR1cm4gY3VycmVudFVSTC51cmw7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGluZGV4ID09PSBjdXJyZW50VVJMLmluZGV4KSB7XHJcbiAgICAgIHJldHVybiBuZXdVUkwudXJsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB1cmw7XHJcbiAgfSk7XHJcbiAgc2NyZWVuc2hvdFVSTHMgPSBbLi4ubmV3U2NyZWVuc2hvdFVSTFNdO1xyXG5cclxuICBkcmF3U2NyZWVuc2hvdExpc3Qoc2NyZWVuc2hvdHNQYXJlbnROb2RlLCBuZXdTY3JlZW5zaG90VVJMUyk7XHJcbn07XHJcblxyXG5jb25zdCBkcmF3U2NyZWVuc2hvdExpc3QgPSAoc2NyZWVuc2hvdHNOb2RlOiBFbGVtZW50LCB1cmxzOiBzdHJpbmdbXSkgPT4ge1xyXG4gIHdoaWxlIChzY3JlZW5zaG90c05vZGUuZmlyc3RDaGlsZCkge1xyXG4gICAgc2NyZWVuc2hvdHNOb2RlLnJlbW92ZUNoaWxkKHNjcmVlbnNob3RzTm9kZS5maXJzdENoaWxkKTtcclxuICB9XHJcblxyXG4gIHVybHMuZm9yRWFjaCgodXJsLCBpbmRleCkgPT4ge1xyXG4gICAgY29uc3Qgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICBjb25zdCBpbWdOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcclxuXHJcbiAgICBub2RlLmNsYXNzTGlzdC5hZGQoXHJcbiAgICAgIFwiY29sLTZcIixcclxuICAgICAgXCJjb2wtbWQtM1wiLFxyXG4gICAgICBcInNjcmVlbnNob3RzX19saXN0X19pdGVtXCIsXHJcbiAgICAgIGBzY3JlZW5zaG90c19fbGlzdF9faXRlbV9fJHtpbmRleH1gXHJcbiAgICApO1xyXG4gICAgbm9kZS5kcmFnZ2FibGUgPSB0cnVlO1xyXG4gICAgaW1nTm9kZS5zcmMgPSB1cmw7XHJcbiAgICBpbWdOb2RlLmFsdCA9IFwic2NyZWVuc2hvdFwiO1xyXG5cclxuICAgIG5vZGUuYXBwZW5kQ2hpbGQoaW1nTm9kZSk7XHJcbiAgICBzY3JlZW5zaG90c05vZGUuYXBwZW5kQ2hpbGQobm9kZSk7XHJcblxyXG4gICAgZG9jdW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoYC5zY3JlZW5zaG90c19fbGlzdF9faXRlbV9fJHtpbmRleH1gKVxyXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdzdGFydFwiLCAoZTogSFRNTElucHV0RXZlbnQpID0+XHJcbiAgICAgICAgZHJhZyhlLCB7IGluZGV4LCB1cmwgfSlcclxuICAgICAgKTtcclxuXHJcbiAgICBkb2N1bWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcihgLnNjcmVlbnNob3RzX19saXN0X19pdGVtX18ke2luZGV4fWApXHJcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCAoZTogSFRNTElucHV0RXZlbnQpID0+IGRyb3AoZSwgeyBpbmRleCwgdXJsIH0pKTtcclxuXHJcbiAgICBkb2N1bWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcihgLnNjcmVlbnNob3RzX19saXN0X19pdGVtX18ke2luZGV4fWApXHJcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ292ZXJcIiwgKGU6IEhUTUxJbnB1dEV2ZW50KSA9PiBlLnByZXZlbnREZWZhdWx0KCkpO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuY29uc3QgZHJhd0ljb24gPSAoaWNvbk5vZGU6IEVsZW1lbnQsIHVybDogc3RyaW5nKSA9PiB7XHJcbiAgd2hpbGUgKGljb25Ob2RlLmZpcnN0Q2hpbGQpIHtcclxuICAgIGljb25Ob2RlLnJlbW92ZUNoaWxkKGljb25Ob2RlLmZpcnN0Q2hpbGQpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgaW1nTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XHJcbiAgaW1nTm9kZS5jbGFzc0xpc3QuYWRkKFwiaWNvbl9faXRlbVwiKTtcclxuICBpbWdOb2RlLnNyYyA9IHVybDtcclxuICBpbWdOb2RlLmFsdCA9IFwic2NyZWVuc2hvdFwiO1xyXG4gIGljb25Ob2RlLmFwcGVuZENoaWxkKGltZ05vZGUpO1xyXG59O1xyXG4iLCJleHBvcnQgY29uc3QgVVBMT0FEID0gKFxyXG4gIGRhdGE6IEZvcm1EYXRhLFxyXG4gIHVybDogc3RyaW5nID0gXCIvaW1hZ2VzL3VwbG9hZFwiXHJcbik6IFByb21pc2U8YW55PiA9PlxyXG4gIGZldGNoKHVybCwge1xyXG4gICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgIGJvZHk6IGRhdGFcclxuICB9KS50aGVuKHJlcyA9PiByZXMuanNvbigpKTtcclxuXHJcbmV4cG9ydCBjb25zdCBQT1NUID0gKHVybDogc3RyaW5nLCBkYXRhOiBGb3JtRGF0YSk6IFByb21pc2U8YW55PiA9PlxyXG4gIGZldGNoKHVybCwge1xyXG4gICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgIGJvZHk6IGRhdGEsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCJcclxuICAgIH1cclxuICB9KS50aGVuKHJlcyA9PiByZXMuanNvbigpKTtcclxuXHJcbmV4cG9ydCBjb25zdCBHRVQgPSAodXJsOiBzdHJpbmcpOiBQcm9taXNlPGFueT4gPT5cclxuICBmZXRjaCh1cmwpLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpO1xyXG5cclxuZXhwb3J0IGNvbnN0IFBVVCA9ICh1cmw6IHN0cmluZywgZGF0YTogRm9ybURhdGEpOiBQcm9taXNlPGFueT4gPT5cclxuICBmZXRjaCh1cmwsIHtcclxuICAgIG1ldGhvZDogXCJQVVRcIixcclxuICAgIGJvZHk6IGRhdGFcclxuICB9KS50aGVuKHJlcyA9PiByZXMuanNvbigpKTtcclxuXHJcbmV4cG9ydCBjb25zdCBERUxFVEUgPSAodXJsOiBzdHJpbmcpOiBQcm9taXNlPGFueT4gPT5cclxuICBmZXRjaCh1cmwsIHsgbWV0aG9kOiBcIkRFTEVURVwiIH0pLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpO1xyXG4iXX0=
